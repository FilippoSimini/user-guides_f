name: Export All Commits

on:
  workflow_dispatch: # Allows you to run this manually from the Actions tab

jobs:
  get-history:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Crucial: 0 fetches all history for all branches and tags
      
      - name: Extract Log for Each File
        run: |
          # Find all files (excluding the .git folder) and run git log on each
          find . -type f -not -path '*/.*' | while read -r file; do
              git log --stat --pretty=format:"__|__$file||%H||%s||%an||%ae||%ar||%ad||%B" -- "$file" >> commit_history.txt
          done
          
      - name: Upload Commit File
        uses: actions/upload-artifact@v4
        with:
          name: repository-commit-log
          path: commit_history.txt
